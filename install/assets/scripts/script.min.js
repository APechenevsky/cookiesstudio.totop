window.onload = function() {

    // Получение JSON параметров
    var params = document.getElementById("cookiesstudio__totop_params").getAttribute("data-params");
    var params = JSON.parse(params);

    // Если модуль включен
    if(params.switch_on == "Y"){

        // Получение стилей
        var style  = "width: " + params.width + "px;";
        style += "height: " + params.height + "px;";
        style += "border-radius: " + params.radius + "px;";
        style += "background-color: " + params.color + ";";
        style += "bottom: " + params.indent_bottom + "px;";
        style += params.side + ": " + params.indent_side + "px;";

        // Добавление копки с нужными стилями
        document.body.insertAdjacentHTML("beforeend",'<div id="cookiesstudio__totop_button" style="' + style + '"></div>');
        var button = document.getElementById("cookiesstudio__totop_button");

        // Высота, с которой необходимо отображать кнопку
        var higch = 400;

        // Отображение кнопки при загрузке страницы
        document.addEventListener("load", function(){
            if(document.scrollTop > higch){
                if(button.style.display == 'none') {
                    fadeIn(button, 'flex');
                }
            }
            return false;
        });

        // Отображение кнопки при прокрутке страницы
        document.addEventListener("scroll", function(){
            if(window.pageYOffset > higch){
                if(button.style.display == 'none') {
                    fadeIn(button, 'flex');
                }
            }else{
                fadeOut(button);
            };
            return false;
        });

        // Клик по кнопке
        button.addEventListener("click", function(){
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
            return false;
        });
    };
};

// Появление кнопки
function fadeIn(el, display) {
    el.style.opacity = 0;
    el.style.display = display || "block";
    (function fade() {
        var val = parseFloat(el.style.opacity);
        if (!((val += .1) > 1)) {
            el.style.opacity = val;
            requestAnimationFrame(fade);
        }
    })();
}

// Скрытие кнопки
function fadeOut(el) {
    el.style.opacity = 1;
    (function fade() {
        if ((el.style.opacity -= .1) < 0) {
            el.style.display = "none";
        } else {
            requestAnimationFrame(fade);
        }
    })();
};